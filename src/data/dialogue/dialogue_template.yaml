dialogue_trees:
    - id: unique_dialogue_id
        character: NPC Name
        location: location_id # Optional: restrict dialogue to specific location
        priority: 1 # Higher priority dialogues take precedence
        repeatable: false # Can this dialogue be repeated?
        root: node_1
        
        # Global conditions that must be met for this dialogue tree to be available
    - conditions:
            - type: quest_status
              quest_id: example_quest
              status: active # active, completed, not_started
            - type: item_in_inventory
              item_id: special_key
              quantity: 1
            - type: level_requirement
              min_level: 5
            - type: time_of_day
              hours: [6, 7, 8, 9, 10, 11] # Morning hours
            - type: relationship
              character: NPC Name
              min_relationship: 10
            - type: flag
              flag: has_met_character
              value: true
        
        # Variables that can be set/modified during dialogue
        variables:
            first_meeting: true
            trust_level: 0
            topic_discussed: null
        
        nodes:
            node_1:
                # NPC dialogue with conditional text based on variables/flags
                text: 
                    - condition:
                        type: variable
                        variable: first_meeting
                        value: true
                      text: "Ah, a new face! Welcome to our humble village, traveler."
                    - condition:
                        type: relationship
                        character: NPC Name
                        min_relationship: 20
                      text: "Good to see you again, my trusted friend!"
                    - default: "Hello there, what brings you by today?"
                
                # Actions to perform when entering this node
                on_enter:
                    - type: set_variable
                      variable: first_meeting
                      value: false
                    - type: add_relationship
                      character: NPC Name
                      amount: 1
                    - type: play_sound
                      sound_id: npc_greeting
                
                responses:
                    - text: "I'm looking for work. Do you have any tasks?"
                      next: node_job_inquiry
                      conditions:
                        - type: quest_status
                          quest_id: main_quest_01
                          status: active
                      
                    - text: "Tell me about this place."
                      next: node_location_info
                      
                    - text: "[Intimidate] Give me your gold or else!"
                      next: node_intimidation
                      conditions:
                        - type: skill_check
                          skill: intimidation
                          difficulty: 15
                        - type: stat_requirement
                          stat: charisma
                          min_value: 14
                      skill_check:
                        skill: intimidation
                        difficulty: 15
                        success_node: node_intimidation_success
                        failure_node: node_intimidation_failure
                        
                    - text: "[Persuade] Perhaps we could help each other?"
                      next: node_persuasion
                      skill_check:
                        skill: persuasion
                        difficulty: 12
                        success_node: node_persuasion_success
                        failure_node: node_persuasion_failure
                      
                    - text: "I should go."
                      next: end
            
            node_job_inquiry:
                text: "As a matter of fact, I do have something that needs doing. There's been strange noises coming from the old mill at night."
                
                on_enter:
                    - type: set_variable
                      variable: topic_discussed
                      value: mill_investigation
                
                responses:
                    - text: "I'll investigate the mill for you."
                      next: node_accept_quest
                      actions:
                        - type: start_quest
                          quest_id: mill_investigation
                        - type: add_relationship
                          character: NPC Name
                          amount: 5
                        - type: add_journal_entry
                          entry: "Agreed to investigate strange noises at the old mill."
                          
                    - text: "That sounds dangerous. What's in it for me?"
                      next: node_negotiate_reward
                      
                    - text: "Sorry, I'm not interested in ghost hunting."
                      next: node_decline_quest
                      actions:
                        - type: add_relationship
                          character: NPC Name
                          amount: -2
            
            node_location_info:
                text: "This is Millhaven, a peaceful farming community. We've been here for three generations, living off the fertile land and the old water mill."
                
                responses:
                    - text: "What can you tell me about the mill?"
                      next: node_mill_history
                      
                    - text: "Any interesting people I should meet?"
                      next: node_notable_people
                      
                    - text: "Thanks for the information."
                      next: end
            
            node_intimidation_success:
                text: "P-please don't hurt me! Here, take this, just leave me be!"
                
                on_enter:
                    - type: add_item
                      item_id: gold_coins
                      quantity: 25
                    - type: add_relationship
                      character: NPC Name
                      amount: -20
                    - type: set_flag
                      flag: intimidated_npc_name
                      value: true
                    - type: add_reputation
                      type: negative
                      amount: 5
                      reason: intimidation
                
                responses:
                    - text: "Smart choice."
                      next: end
            
            node_intimidation_failure:
                text: "Ha! You don't scare me, stranger. I've dealt with tougher folk than you. Now get out of my sight!"
                
                on_enter:
                    - type: add_relationship
                      character: NPC Name
                      amount: -10
                    - type: set_flag
                      flag: failed_intimidation_npc_name
                      value: true
                
                responses:
                    - text: "This isn't over."
                      next: end
                    - text: "I... I apologize for my rudeness."
                      next: node_apologize
            
            node_persuasion_success:
                text: "You know what? I like your approach. Let me tell you about a little opportunity that might interest both of us..."
                
                on_enter:
                    - type: add_relationship
                      character: NPC Name
                      amount: 8
                    - type: unlock_dialogue_tree
                      dialogue_id: npc_name_secret_quest
                
                responses:
                    - text: "I'm listening."
                      next: node_secret_opportunity
                    - text: "What kind of opportunity?"
                      next: node_secret_opportunity
            
            node_persuasion_failure:
                text: "Nice try, but I wasn't born yesterday. I don't make deals with smooth-talking strangers."
                
                responses:
                    - text: "Fair enough. Perhaps another time."
                      next: end
            
            node_accept_quest:
                text: "Excellent! The mill is just north of here, past the wheat fields. Be careful - whatever's in there has the whole village spooked."
                
                responses:
                    - text: "I'll get to the bottom of this."
                      next: end
                      actions:
                        - type: show_quest_marker
                          location: old_mill
            
            node_negotiate_reward:
                text: 
                    - condition:
                        type: skill_check_result
                        skill: persuasion
                        difficulty: 10
                        success: true
                      text: "You drive a hard bargain. I can offer 100 gold coins and this family heirloom if you solve our problem."
                      actions:
                        - type: set_variable
                          variable: reward_negotiated
                          value: true
                    - default: "I can spare 50 gold coins, that's all I have."
                
                responses:
                    - text: "Deal. I'll investigate the mill."
                      next: node_accept_quest
                      actions:
                        - type: start_quest
                          quest_id: mill_investigation
                        - type: conditional_action
                          condition:
                            type: variable
                            variable: reward_negotiated
                            value: true
                          action:
                            type: set_quest_reward
                            quest_id: mill_investigation
                            gold: 100
                            items: [family_heirloom]
                        - type: conditional_action
                          condition:
                            type: variable
                            variable: reward_negotiated
                            value: false
                          action:
                            type: set_quest_reward
                            quest_id: mill_investigation
                            gold: 50
                    
                    - text: "That's not enough. Find someone else."
                      next: node_decline_quest
            
            end:
                text: 
                    - condition:
                        type: relationship
                        character: NPC Name
                        min_relationship: 15
                      text: "Safe travels, my friend. May the gods watch over you."
                    - condition:
                        type: relationship
                        character: NPC Name
                        max_relationship: -5
                      text: "Good riddance."
                    - default: "Farewell, traveler."
                
                on_enter:
                    - type: save_dialogue_state
                    - type: update_npc_mood
                      character: NPC Name
                
                responses: []

# Additional dialogue tree for returning players
    - id: npc_name_followup
        character: NPC Name
        priority: 2
        repeatable: true
        root: followup_1
        
        conditions:
            - type: flag
              flag: met_npc_name
              value: true
            - type: quest_status
              quest_id: mill_investigation
              status: completed
        
        nodes:
            followup_1:
                text: "Ah, the hero who solved our mill problem! The whole village is grateful for what you did."
                
                responses:
                    - text: "Just doing what needed to be done."
                      next: end
                    - text: "Do you have any other work for me?"
                      next: check_for_new_quests
            
            check_for_new_quests:
                text:
                    - condition:
                        type: level_requirement
                        min_level: 10
                      text: "Actually, there is something else... but it's dangerous work, only for experienced adventurers."
                      next: high_level_quest_intro
                    - default: "Nothing at the moment, but check back later. There's always something happening around here."
                      next: end
