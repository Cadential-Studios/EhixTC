<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Manager Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .location-card {
            transition: all 0.3s ease;
        }
        .location-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-400 mb-4">Location Manager Test</h1>
            <p class="text-gray-300 mb-4">Testing the individual location file loading system</p>
            <button id="test-load" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold">
                <i class="fas fa-play mr-2"></i>Load All Locations
            </button>
            <button id="test-modal" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg font-semibold ml-4" style="display:none;">
                <i class="fas fa-eye mr-2"></i>Test Location Modal
            </button>
        </div>

        <div id="loading" class="text-center py-8 hidden">
            <i class="fas fa-spinner fa-spin text-4xl text-blue-400"></i>
            <p class="mt-4 text-xl">Loading locations...</p>
        </div>

        <div id="results" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="locations-grid">
                <!-- Location cards will be inserted here -->
            </div>
        </div>

        <div id="error" class="hidden bg-red-600 p-4 rounded-lg">
            <h3 class="text-xl font-bold mb-2">Error Loading Locations</h3>
            <p id="error-message"></p>
        </div>

        <div id="test-log" class="mt-8 bg-gray-800 p-4 rounded-lg">
            <h3 class="text-xl font-bold mb-4">Test Log</h3>
            <div id="log-content" class="font-mono text-sm space-y-1 max-h-64 overflow-y-auto">
                <div class="text-gray-400">Click "Load All Locations" to start testing...</div>
            </div>
        </div>
    </div>

    <!-- Location Modal -->
    <div id="location-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h2 id="modal-title" class="text-2xl font-bold text-white"></h2>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // Region configuration for styling
        const REGION_CONFIG = {
            'frontier': {
                name: 'Frontier',
                color: 'bg-orange-600',
                textColor: 'text-orange-200'
            },
            'pridelands': {
                name: 'Pridelands', 
                color: 'bg-yellow-600',
                textColor: 'text-yellow-200'
            },
            'gaia': {
                name: 'Gaia',
                color: 'bg-green-600',
                textColor: 'text-green-200'
            },
            'towns': {
                name: 'Towns',
                color: 'bg-blue-600',
                textColor: 'text-blue-200'
            },
            'unknown': {
                name: 'Unknown',
                color: 'bg-gray-600',
                textColor: 'text-gray-200'
            }
        };

        function getRegionInfo(regionKey) {
            const normalizedKey = regionKey ? regionKey.toLowerCase() : 'unknown';
            const config = REGION_CONFIG[normalizedKey] || REGION_CONFIG.unknown;
            
            return {
                name: config.name,
                color: config.color,
                textColor: config.textColor,
                createBadge: (additionalClasses = '') => 
                    `<span class="${config.color} text-white px-2 py-1 text-xs rounded font-medium ${additionalClasses}">${config.name}</span>`
            };
        }

        // Global variables for testing
        let DATA_BASE_PATH = './src/data/';
        let locationsData = {};
        let gameData = {
            player: {
                gold: 100,
                hitPoints: 80,
                maxHitPoints: 100,
                location: 'westhaven'
            }
        };

        // Mock functions
        function showGameMessage(message, type) {
            log(`${type.toUpperCase()}: ${message}`, type);
        }

        function renderLocation(locationId) {
            log(`Rendering location: ${locationId}`, 'info');
        }

        function updateDisplay() {
            log('Display updated', 'info');
        }

        // Logging function
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': 'text-blue-400',
                'success': 'text-green-400',
                'warning': 'text-yellow-400',
                'error': 'text-red-400'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || 'text-gray-300';
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Simple LocationManager implementation for testing
        class LocationManager {
            constructor() {
                this.locations = {};
                this.currentLocation = null;
            }

            async loadBaseLocations() {
                const locationPaths = [
                    'locations/frontier/westwalker_camp.json',
                    'locations/frontier/griefwood_edge.json',
                    'locations/frontier/griefwood_clearing.json',
                    'locations/towns/westhaven.json',
                    'locations/towns/jorn.json',
                    'locations/pridelands/leonin_encampment.json',
                    'locations/gaia/gaian_library.json'
                ];

                this.locations = {};
                let loadedCount = 0;

                for (const path of locationPaths) {
                    try {
                        log(`Loading: ${path}`, 'info');
                        const response = await fetch(`${DATA_BASE_PATH}${path}`);
                        
                        if (response.ok) {
                            const locationData = await response.json();
                            this.locations[locationData.id] = locationData;
                            loadedCount++;
                            log(`✓ Loaded: ${locationData.name}`, 'success');
                        } else {
                            log(`✗ Failed to load ${path}: ${response.status}`, 'error');
                        }
                    } catch (error) {
                        log(`✗ Error loading ${path}: ${error.message}`, 'error');
                    }
                }

                log(`Successfully loaded ${loadedCount} locations`, 'success');
                
                if (loadedCount === 0) {
                    throw new Error('No location files could be loaded');
                }

                // Sync with global
                locationsData = { ...this.locations };
            }

            getLocation(locationId) {
                return this.locations[locationId] || null;
            }

            showLocationModal(locationId) {
                const location = this.getLocation(locationId);
                if (!location) return;

                const modal = document.getElementById('location-modal');
                const title = document.getElementById('modal-title');
                const content = document.getElementById('modal-content');

                title.textContent = location.name;
                content.innerHTML = `
                    <div class="space-y-4">
                        <div class="text-gray-400 text-sm mb-3">
                            ${getRegionInfo(location.region).createBadge('mr-2')}
                            ${location.tags ? location.tags.join(' • ') : ''}
                        </div>
                        
                        ${location.image ? `<div class="rounded-lg overflow-hidden">
                            <img src="${location.image}" alt="${location.name}" class="w-full h-48 object-cover">
                        </div>` : ''}
                        
                        <p class="text-gray-300">${location.description}</p>
                        
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <h4 class="font-semibold text-white">Available Actions:</h4>
                                <div class="text-gray-300">
                                    ${Object.entries(location.available_actions || {})
                                        .filter(([key, value]) => value)
                                        .map(([key]) => key)
                                        .join(', ') || 'None'}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-white">Services:</h4>
                                <div class="text-gray-300">
                                    ${Object.entries(location.services || {})
                                        .filter(([key, value]) => value.available)
                                        .map(([key]) => key)
                                        .join(', ') || 'None'}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-white">NPCs:</h4>
                                <div class="text-gray-300">${location.npcs ? location.npcs.length : 0}</div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-white">Shops:</h4>
                                <div class="text-gray-300">${location.shops ? location.shops.length : 0}</div>
                            </div>
                        </div>

                        ${location.connections ? `
                            <div>
                                <h4 class="font-semibold text-white">Connections:</h4>
                                <div class="grid grid-cols-1 gap-2 mt-2">
                                    ${Object.entries(location.connections).map(([id, conn]) => `
                                        <div class="bg-gray-700 p-2 rounded text-sm">
                                            <strong>${conn.name}</strong> - ${conn.distance}km, ${conn.travel_time}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${location.points_of_interest ? `
                            <div>
                                <h4 class="font-semibold text-white">Points of Interest:</h4>
                                <div class="space-y-2 mt-2">
                                    ${location.points_of_interest.map(poi => `
                                        <div class="bg-gray-700 p-2 rounded text-sm">
                                            <strong>${poi.name}</strong><br>
                                            <span class="text-gray-400">${poi.description}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;

                modal.classList.remove('hidden');
            }
        }

        // Initialize test
        const locationManager = new LocationManager();

        // Event listeners
        document.getElementById('test-load').addEventListener('click', async () => {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            const testModal = document.getElementById('test-modal');
            
            loading.classList.remove('hidden');
            results.classList.add('hidden');
            error.classList.add('hidden');

            try {
                await locationManager.loadBaseLocations();
                
                // Display results
                displayLocations();
                
                loading.classList.add('hidden');
                results.classList.remove('hidden');
                testModal.style.display = 'inline-block';
                
            } catch (err) {
                loading.classList.add('hidden');
                error.classList.remove('hidden');
                document.getElementById('error-message').textContent = err.message;
                log(`Test failed: ${err.message}`, 'error');
            }
        });

        document.getElementById('test-modal').addEventListener('click', () => {
            if (Object.keys(locationManager.locations).length > 0) {
                const firstLocationId = Object.keys(locationManager.locations)[0];
                locationManager.showLocationModal(firstLocationId);
            }
        });

        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('location-modal').classList.add('hidden');
        });

        function displayLocations() {
            const grid = document.getElementById('locations-grid');
            grid.innerHTML = '';

            Object.values(locationManager.locations).forEach(location => {
                const card = document.createElement('div');
                card.className = 'location-card bg-gray-800 p-4 rounded-lg border border-gray-700 cursor-pointer';
                card.onclick = () => locationManager.showLocationModal(location.id);
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="text-xl font-semibold text-white">${location.name}</h3>
                        ${getRegionInfo(location.region).createBadge('mr-2')}
                    </div>
                    
                    <p class="text-gray-300 text-sm mb-3 line-clamp-3">${location.description}</p>
                    
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Actions:</span>
                            <span class="text-white">${Object.entries(location.available_actions || {}).filter(([k,v]) => v).length}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">NPCs:</span>
                            <span class="text-white">${location.npcs ? location.npcs.length : 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Shops:</span>
                            <span class="text-white">${location.shops ? location.shops.length : 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Danger:</span>
                            <span class="text-${location.danger_level === 'safe' ? 'green' : location.danger_level === 'moderate' ? 'yellow' : 'red'}-400">
                                ${location.danger_level}
                            </span>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Initial log
        log('Location Manager Test initialized', 'success');
        log('Ready to test location loading system', 'info');
    </script>
</body>
</html>
